import json
from backend.agents.plan_agent import plan_agent
from pathlib import Path
import asyncio

async def test_plan_agent():
    
    # Example input
    user_query = [{'name': 'National Film Archive of Japan', 'address': '3 Chome-7-6 Kyobashi, Chuo City, Tokyo 104-0031, Japan', 'lat': 35.6755095, 'lng': 139.7706169, 'rating': 4.2, 'price_level': None, 'types': ['museum', 'movie_theater', 'tourist_attraction', 'point_of_interest', 'establishment'], 'place_id': 'ChIJDTEgTOKLGGARRjeD6dnAoVY', 'source_query': 'movie attractions in Tokyo', 'source': 'api'}, {'name': 'Rokku Broadway', 'address': '2 Chome Asakusa, Taito City, Tokyo 111-0032, Japan', 'lat': 35.7144858, 'lng': 139.7933506, 'rating': 3.2, 'price_level': None, 'types': ['tourist_attraction', 'point_of_interest', 'establishment'], 'place_id': 'ChIJvZbXEwCPGGARbIusF-AFrgM', 'source_query': 'movie attractions in Tokyo', 'source': 'api'}, {'name': 'Warner Bros. Studio Tour Tokyo - The Making of Harry Potter', 'address': '1 Chome-1-7 Kasugacho, Nerima City, Tokyo 179-0074, Japan', 'lat': 35.745183, 'lng': 139.6460909, 'rating': 4.7, 'price_level': None, 'types': ['amusement_park', 'tourist_attraction', 'point_of_interest', 'establishment'], 'place_id': 'ChIJZzjXkvLtGGARm2YFfi26zoU', 'source_query': 'movie attractions in Tokyo', 'source': 'api'}, {'name': 'Godzilla Head', 'address': '1 Chome-19 Kabukicho, Shinjuku City, Tokyo 160-0021, Japan', 'lat': 35.6950521, 'lng': 139.7019117, 'rating': 4.4, 'price_level': None, 'types': ['tourist_attraction', 'point_of_interest', 'establishment'], 'place_id': 'ChIJzRzI3HSNGGARRwZW6AtJfi0', 'source_query': 'movie attractions in Tokyo', 'source': 'api'}, {'name': 'Godzilla Statue', 'address': '1 Chome-3-2 Yurakucho, Chiyoda City, Tokyo 100-0006, Japan', 'lat': 35.6736998, 'lng': 139.7602977, 'rating': 3.8, 'price_level': None, 'types': ['tourist_attraction', 'point_of_interest', 'establishment'], 'place_id': 'ChIJj9FCzO-LGGARv0qenUaDws4', 'source_query': 'movie attractions in Tokyo', 'source': 'api'}, {'name': 'TYFFONIUM Odaiba', 'address': '1 Chome-1-10 Aomi, Koto City, Tokyo 135-0064, Japan', 'lat': 35.6251282, 'lng': 139.7754216, 'rating': 3.6, 'price_level': None, 'types': ['amusement_park', 'point_of_interest', 'establishment'], 'place_id': 'ChIJ7afZ1vmJGGARnepG7MxYGoM', 'source_query': 'movie themed experiences in Tokyo', 'source': 'api'}, {'name': 'Harry Potter Stairs & Time Turner', 'address': 'Japan, 〒107-0052 Tokyo, Minato City, Akasaka, 5 Chome−4−5 赤坂駅', 'lat': 35.6726774, 'lng': 139.735835, 'rating': 4.5, 'price_level': None, 'types': ['tourist_attraction', 'point_of_interest', 'establishment'], 'place_id': 'ChIJhyc0046LGGARTtseD5A7W_M', 'source_query': 'movie themed experiences in Tokyo', 'source': 'api'}, {'name': 'Bunkamura Le Cinéma', 'address': 'Shibuya Toei Plaza, 1 Chome-24-12 Shibuya, Tokyo 150-0002, Japan', 'lat': 35.65998690000001, 'lng': 139.702162, 'rating': 4.1, 'price_level': None, 'types': ['movie_theater', 'point_of_interest', 'establishment'], 'place_id': 'ChIJdR6yw6uMGGARJCU4fsk6BO4', 'source_query': 'movie themed experiences in Tokyo', 'source': 'api'}, {'name': 'Japan Film Commission', 'address': 'Japan, 〒104-0045 Tokyo, Chuo City, Tsukiji, 4 Chome−1−1 東劇ビル 8F', 'lat': 35.6677103, 'lng': 139.7686424, 'rating': None, 'price_level': None, 'types': ['point_of_interest', 'establishment'], 'place_id': 'ChIJEadT26yOGGAR1sbjT6Hp014', 'source_query': 'movie filming locations in Tokyo', 'source': 'api'}, {'name': 'Cameraman Tokyo - English Support - Video Production Crew', 'address': 'Japan, 〒161-0033 Tokyo, Shinjuku City, Shimoochiai, 4 Chome−4−6 apt 203', 'lat': 35.7169074, 'lng': 139.6950412, 'rating': 5, 'price_level': None, 'types': ['point_of_interest', 'establishment'], 'place_id': 'ChIJ-Xv9p3GNGGARH1N5IzpVQ6A', 'source_query': 'movie filming locations in Tokyo', 'source': 'api'}, {'name': 'TOHO Cinemas Hibiya', 'address': 'Japan, 〒100-0006 Tokyo, Chiyoda City, Yurakucho, 1 Chome−1−2 ４Ｆ', 'lat': 35.6737436, 'lng': 139.7591762, 'rating': 4.3, 'price_level': None, 'types': ['movie_theater', 'shopping_mall', 'cafe', 'meal_takeaway', 'restaurant', 'food', 'point_of_interest', 'store', 'establishment'], 'place_id': 'ChIJ31e8ELqLGGARGwjapF0PUiM', 'source_query': 'movie filming locations in Tokyo', 'source': 'api'}, {'name': 'TOHO Cinemas Nihonbashi', 'address': 'Japan, 〒103-0022 Tokyo, Chuo City, Nihonbashimuromachi, 2 Chome−3−1 コレド室町2 3F', 'lat': 35.6869002, 'lng': 139.7748527, 'rating': 4.2, 'price_level': None, 'types': ['movie_theater', 'shopping_mall', 'cafe', 'meal_takeaway', 'restaurant', 'food', 'point_of_interest', 'store', 'establishment'], 'place_id': 'ChIJAe0wr1WJGGARuuNpEzGN8Mo', 'source_query': 'movie filming locations in Tokyo', 'source': 'api'}, {'name': 'TOHO Cinemas Shinjuku', 'address': 'Japan, 〒160-0021 Tokyo, Shinjuku City, Kabukicho, 1 Chome−19−1 Shinjuku Toho Building, ３階', 'lat': 35.6951484, 'lng': 139.7019653, 'rating': 4.1, 'price_level': None, 'types': ['movie_theater', 'shopping_mall', 'cafe', 'meal_takeaway', 'restaurant', 'food', 'point_of_interest', 'store', 'establishment'], 'place_id': 'ChIJ__JMK9iMGGAR6P_7QHoOGE4', 'source_query': 'movie experience for INFP in Tokyo', 'source': 'api'}, {'name': 'Shinjuku Piccadilly Cinema', 'address': '3 Chome-15-15 Shinjuku, Shinjuku City, Tokyo 160-0022, Japan', 'lat': 35.6927885, 'lng': 139.7037755, 'rating': 4, 'price_level': None, 'types': ['movie_theater', 'point_of_interest', 'establishment'], 'place_id': 'ChIJ_bu8a8WMGGARpvHpKekKwL0', 'source_query': 'movie experience for INFP in Tokyo', 'source': 'api'}, {'name': 'Marunouchi Piccadilly', 'address': 'Japan, 〒100-0006 Tokyo, Chiyoda City, Yurakucho, 2 Chome−5−1 有楽町マリオン9F', 'lat': 35.67343049999999, 'lng': 139.7629245, 'rating': 4.1, 'price_level': None, 'types': ['movie_theater', 'point_of_interest', 'establishment'], 'place_id': 'ChIJTe2iyDi6JhURH3AowredcuI', 'source_query': 'movie experience for INFP in Tokyo', 'source': 'api'}, {'name': 'United Cinemas Aqua City Odaiba', 'address': 'Japan, 〒135-0091 Tokyo, Minato City, Daiba, 1 Chome−7−1 AQUA CITY ODAIBA, 1F', 'lat': 35.6282733, 'lng': 139.7744317, 'rating': 4.1, 'price_level': None, 'types': ['movie_theater', 'point_of_interest', 'establishment'], 'place_id': 'ChIJL8dbO_aJGGARGPKsVFLNFhc', 'source_query': 'movie experience for INFP in Tokyo', 'source': 'api'}, {'name': 'Donguri Republic (Ghibli Store in Tokyo Skytree Town Solamachi)', 'address': 'Japan, 〒131-0045 Tokyo, Sumida City, Oshiage, 1 Chome−1−2 東京スカイツリータウン・ソラマチ 2F', 'lat': 35.7108244, 'lng': 139.8128149, 'rating': 4.2, 'price_level': None, 'types': ['point_of_interest', 'store', 'establishment'], 'place_id': 'ChIJA73_QdaOGGARbeUkWZMv210', 'source_query': 'Totoro in Tokyo related to movies', 'source': 'api'}, {'name': 'Donguri Republic (Ghibli Store) DiverCity Tokyo Plaza', 'address': 'Japan, 〒135-0064 Tokyo, Koto City, Aomi, 1 Chome−1−10 ダイバーシティ東京プラザ 5F', 'lat': 35.6248877, 'lng': 139.7759954, 'rating': 4.6, 'price_level': None, 'types': ['point_of_interest', 'store', 'establishment'], 'place_id': 'ChIJb8zxaVOJGGARTUht7fHfkpY', 'source_query': 'Totoro in Tokyo related to movies', 'source': 'api'}, {'name': 'Ghibli Donguri Republic Tokyo Station', 'address': 'First Avenue Tokyo Station, 1 Chome-9-1 Marunouchi, Chiyoda City, Tokyo 100-0005, Japan', 'lat': 35.6818583, 'lng': 139.7686687, 'rating': 4.3, 'price_level': None, 'types': ['home_goods_store', 'point_of_interest', 'store', 'establishment'], 'place_id': 'ChIJYySqIPuLGGARoe1sGm-47Mw', 'source_query': 'Totoro in Tokyo related to movies', 'source': 'api'}, {'name': 'Starbucks Reserve Roastery Tokyo', 'address': '2 Chome-19-23 Aobadai, Meguro City, Tokyo 153-0042, Japan', 'lat': 35.6492642, 'lng': 139.6925907, 'rating': 4.5, 'price_level': 2, 'types': ['cafe', 'food', 'store', 'bar', 'point_of_interest', 'establishment'], 'place_id': 'ChIJq_fYt4iLGGARrOojmQ4IMyE', 'source_query': 'quiet cafe in Tokyo related to movies', 'source': 'api'}, {'name': 'Film Coffee&Things', 'address': '1 Chome-32-21 Sangenjaya, Setagaya City, Tokyo 154-0024, Japan', 'lat': 35.6416409, 'lng': 139.6705987, 'rating': 4.4, 'price_level': None, 'types': ['cafe', 'bakery', 'food', 'store', 'point_of_interest', 'establishment'], 'place_id': 'ChIJ0wM8bN71GGAR0AbK68qU_lc', 'source_query': 'quiet cafe in Tokyo related to movies', 'source': 'api'}, {'name': 'Manga and Coffee', 'address': 'Japan, 〒151-0073 Tokyo, Shibuya, Sasazuka, 2 Chome−42−17 あきもとビル２F', 'lat': 35.6763831, 'lng': 139.6677558, 'rating': 4.6, 'price_level': None, 'types': ['cafe', 'food', 'point_of_interest', 'establishment'], 'place_id': 'ChIJsZHfBxnzGGAReMmdIo2jl3s', 'source_query': 'quiet cafe in Tokyo related to movies', 'source': 'api'}, {'name': 'LATTE ART MANIA TOKYO', 'address': 'Japan, 〒107-0061 Tokyo, Minato City, Kita-Aoyama, 2 Chome−9−13 斉藤ビル 1F', 'lat': 35.6711908, 'lng': 139.7164791, 'rating': 4.5, 'price_level': None, 'types': ['cafe', 'food', 'store', 'bar', 'point_of_interest', 'establishment'], 'place_id': 'ChIJJ_6cvAGNGGAR8SvSYZfpyes', 'source_query': 'quiet cafe in Tokyo related to movies', 'source': 'api'}, {'name': 'Ghibli Museum', 'address': '1 Chome-1-83 Shimorenjaku, Mitaka, Tokyo 181-0013, Japan', 'lat': 35.696238, 'lng': 139.5704317, 'rating': 4.5, 'price_level': None, 'types': ['tourist_attraction', 'museum', 'point_of_interest', 'establishment'], 'place_id': 'ChIJLYwD5TTuGGARBZKEP5BV4U0', 'source_query': 'Ghibli Museum in Tokyo', 'matched_from': 'Ghibli Museum', 'source': 'web'}, {'name': 'Hotel Gajoen Tokyo', 'address': '1 Chome-8-1 Shimomeguro, Meguro City, Tokyo 153-0064, Japan', 'lat': 35.6317881, 'lng': 139.7137936, 'rating': 4.3, 'price_level': None, 'types': ['lodging', 'restaurant', 'food', 'point_of_interest', 'establishment'], 'place_id': 'ChIJ-RYxUR6LGGAR3Kk7Wtrwdi8', 'source_query': 'Hotel Gajoen in Tokyo', 'matched_from': 'Hotel Gajoen', 'source': 'web'}, {'name': 'Gonpachi Nishi-Azabu', 'address': '1 Chome-13-11 Nishiazabu, Minato City, Tokyo 106-0031, Japan', 'lat': 35.6601742, 'lng': 139.7235797, 'rating': 4.1, 'price_level': 2, 'types': ['restaurant', 'food', 'point_of_interest', 'establishment'], 'place_id': 'ChIJEwlemnqLGGARhwMuRpwpkBI', 'source_query': 'Gonpachi Restaurant in Tokyo', 'matched_from': 'Gonpachi Restaurant', 'source': 'web'}, {'name': 'WOMB', 'address': '2-16 Maruyamacho, Shibuya, Tokyo 150-0044, Japan', 'lat': 35.6584242, 'lng': 139.6949551, 'rating': 3.8, 'price_level': 2, 'types': ['night_club', 'point_of_interest', 'establishment'], 'place_id': 'ChIJQVW_FKqMGGARQwUFx1IqoEc', 'source_query': 'Womb Nightclub in Tokyo', 'matched_from': 'Womb Nightclub', 'source': 'web'}, {'name': 'Daita', 'address': 'Daita, Setagaya City, Tokyo 155-0033, Japan', 'lat': 35.6579945, 'lng': 139.659239, 'rating': None, 'price_level': None, 'types': ['sublocality_level_2', 'sublocality', 'political'], 'place_id': 'ChIJhymsZ3LzGGARYs4sQJ6XvFA', 'source_query': 'Setagaya Daita in Tokyo', 'matched_from': 'Setagaya Daita', 'source': 'web'}, {'name': 'Kichijōji', 'address': 'Kichijōji, Musashino, Tokyo, Japan', 'lat': 35.704096, 'lng': 139.5802054, 'rating': None, 'price_level': None, 'types': ['colloquial_area', 'political'], 'place_id': 'ChIJBUM940XuGGAR4dVP7nqzDHc', 'source_query': 'Kichijoji in Tokyo', 'matched_from': 'Kichijoji', 'source': 'web'}]

    task = {
    "pois": user_query,
    "mbti": "INFP",
    "days": 3,
    "budget": 200,
    "location": "Tokyo"
    }
    result = await plan_agent.run(task=f"""{task}

Please score candidate activity POIs and plan the itinerary based on the criteria described in your system instructions.
""")

    print(result.messages[-1].content)

if __name__ == "__main__":
    asyncio.run(test_plan_agent())

